# Теоретический план/алгоритм (без кода)

## 1. Определение целей и ограничений
- Зафиксировать цель по риску (target_risk) и/или целевую доходность.
- Определить максимально допустимую просадку и лимиты по позициям.
- Утвердить безрисковую ставку (risk_free_rate) как базовую опору.

## 2. Описание «безрисковой части» портфеля
- Считать «безрисковой частью» капитал, который не задействован в торговле.
- Включить в понятие «безрисковой части» инфраструктуру и риск-лимиты:
  - кэш на счете,
  - ограничители риска,
  - контроль волатильности.

## 3. Описание «рисковой части» портфеля
- Считать «рисковой частью» набор стратегий/активов.
- Для каждой стратегии/актива оценить:
  - ожидаемую доходность,
  - волатильность,
  - устойчивость (стабильность результатов).

## 4. Расчет базовых характеристик
- На исторических данных оценить:
  - среднюю доходность каждой стратегии,
  - волатильность каждой стратегии,
  - корреляции между стратегиями.
- Сформировать «единый рисковый портфель» как сумму стратегий.

## 5. Логика Capital Market Line (CML)
- Использовать CML для определения доли капитала в риске:
  - чем выше целевой риск, тем выше доля рисковой части.
  - чем выше риск стратегий, тем меньше доля рисковой части.
- Итог: определить долю капитала в кэше и в торговле.

## 6. Диверсификация между стратегиями
- Использовать формулу портфеля из двух активов как базовый пример.
- Учитывать корреляции: чем ниже корреляция, тем сильнее снижение риска.
- Перевести это на N стратегий:
  - распределять капитал так, чтобы минимизировать риск при заданной доходности.

## 7. Эффективная граница
- Рассмотреть все возможные комбинации стратегий по весам.
- Построить теоретическую кривую «риск-доходность».
- Определить точки:
  - минимальный риск,
  - максимальная доходность при заданном риске.

## 8. Выбор оптимального портфеля
- Выбрать портфель на эффективной границе под свои цели.
- Опционально использовать критерий максимального Sharpe Ratio.
- Зафиксировать целевые веса стратегий.

## 9. Ребалансировка и адаптация
- Периодически пересчитывать метрики (доходность, волатильность, корреляции).
- Корректировать доли капитала между стратегиями.
- При ухудшении метрик снижать долю рисковой части.

## 10. Контроль и обратная связь
- Отслеживать отклонение фактического риска от целевого.
- При превышении лимитов уменьшать активные позиции.
- Вести журнал решений и пересмотров параметров.
